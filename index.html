<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Japanese Vocab App</title>
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- PWA Meta Tags -->
    <meta name="description" content="Learn Japanese vocabulary with flashcards, multiple choice, and writing exercises">
    <meta name="theme-color" content="#3B82F6">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta name="apple-mobile-web-app-title" content="Japanese Vocab">
    
    <!-- Icons and manifest will be created dynamically -->
</head>
<body class="bg-gray-100">
    <div id="app" class="max-w-md mx-auto bg-white min-h-screen">
        <!-- Loading will be replaced by JavaScript -->
        <div class="p-8 text-center">
            <div class="text-2xl">Loading...</div>
        </div>
    </div>

    <script>
        // Create proper PNG icons from canvas
        function createIcon(size) {
            const canvas = document.createElement('canvas');
            const ctx = canvas.getContext('2d');
            canvas.width = size;
            canvas.height = size;
            
            // Create gradient background
            const gradient = ctx.createLinearGradient(0, 0, size, size);
            gradient.addColorStop(0, '#3B82F6');
            gradient.addColorStop(1, '#8B35FF');
            
            // Draw rounded rectangle
            const radius = size * 0.125;
            ctx.fillStyle = gradient;
            ctx.beginPath();
            ctx.roundRect(0, 0, size, size, radius);
            ctx.fill();
            
            // Draw Japanese character
            ctx.fillStyle = 'white';
            ctx.font = `bold ${size * 0.3}px system-ui`;
            ctx.textAlign = 'center';
            ctx.textBaseline = 'middle';
            ctx.fillText('Êó•', size/2, size/2);
            
            return canvas.toDataURL('image/png');
        }
        
        // Create icons
        const icon192 = createIcon(192);
        const icon512 = createIcon(512);
        
        // Create proper manifest
        const manifest = {
            "id": "japanese-vocab-app",
            "name": "Japanese Vocabulary App",
            "short_name": "JP Vocab",
            "description": "Learn Japanese vocabulary with flashcards, multiple choice, and writing exercises",
            "start_url": "./",
            "display": "standalone",
            "background_color": "#ffffff",
            "theme_color": "#3B82F6",
            "orientation": "portrait-primary",
            "categories": ["education", "productivity"],
            "lang": "en-US",
            "scope": "./",
            "icons": [
                {
                    "src": icon192,
                    "sizes": "192x192",
                    "type": "image/png",
                    "purpose": "any maskable"
                },
                {
                    "src": icon512,
                    "sizes": "512x512",
                    "type": "image/png"
                }
            ],
            "screenshots": [
                {
                    "src": "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAXcAAAKbCAYAAAA7sVlkAAAABHNCSVQICAgIfAhkiAAAAAlwSFlzAAAOxAAADsQBlSsOGwAAABl0RVh0U29mdHdhcmUAd3d3Lmlua3NjYXBlLm9yZ5vuPBoAAAxkSURBVHic7d1frNd1HcfxjynQVpvVWJhZzJUaZptryxZzIxcOHLjARRyVWrCFKysRrUVhxDZdCBpzK8pKFTCrQRJbC2HlgiHEaOuyIoUkxLZatCQJ2TZXdmFC08GBC1/f3/l+f/v9nt4vPB6Xn/f3+/l8X5/zPafn8znn+z2z2WwWALT8zdQBAGifcgdoUO4ADcodYIjZbPY/1fJZZs6TYoEAAAAASUVORK5CYII=",
                    "sizes": "375x667",
                    "type": "image/png",
                    "form_factor": "narrow"
                },
                {
                    "src": "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAwAAAAJYCAYAAADjlOJGAAAABHNCSVQICAgIfAhkiAAAAAlwSFlzAAAOxAAADsQBlSsOGwAAABl0RVh0U29mdHdhcmUAd3d3Lmlua3NjYXBlLm9yZ5vuPBoAAAxkSU=",
                    "sizes": "640x480",
                    "type": "image/png",
                    "form_factor": "wide"
                }
            ],
            "related_applications": [],
            "prefer_related_applications": false
        };

        // Create and inject manifest blob URL
        const manifestBlob = new Blob([JSON.stringify(manifest)], {type: 'application/json'});
        const manifestURL = URL.createObjectURL(manifestBlob);
        
        // Create manifest link
        const manifestLink = document.createElement('link');
        manifestLink.rel = 'manifest';
        manifestLink.href = manifestURL;
        document.head.appendChild(manifestLink);
        
        // Create favicon links
        const favicon = document.createElement('link');
        favicon.rel = 'icon';
        favicon.type = 'image/png';
        favicon.sizes = '192x192';
        favicon.href = icon192;
        document.head.appendChild(favicon);
        
        const appleIcon = document.createElement('link');
        appleIcon.rel = 'apple-touch-icon';
        appleIcon.href = icon192;
        document.head.appendChild(appleIcon);
        
        // Register Enhanced Service Worker
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', function() {
                navigator.serviceWorker.register('data:application/javascript;base64,' + btoa(`
                    const CACHE_NAME = 'japanese-vocab-v2';
                    const urlsToCache = [
                        './',
                        './index.html',
                        'https://cdn.tailwindcss.com'
                    ];

                    self.addEventListener('install', function(event) {
                        event.waitUntil(
                            caches.open(CACHE_NAME)
                                .then(function(cache) {
                                    console.log('Opened cache');
                                    return cache.addAll(urlsToCache);
                                })
                        );
                        self.skipWaiting();
                    });

                    self.addEventListener('activate', function(event) {
                        event.waitUntil(
                            caches.keys().then(function(cacheNames) {
                                return Promise.all(
                                    cacheNames.map(function(cacheName) {
                                        if (cacheName !== CACHE_NAME) {
                                            return caches.delete(cacheName);
                                        }
                                    })
                                );
                            })
                        );
                        self.clients.claim();
                    });

                    self.addEventListener('fetch', function(event) {
                        event.respondWith(
                            caches.match(event.request)
                                .then(function(response) {
                                    // Cache hit - return response
                                    if (response) {
                                        return response;
                                    }
                                    
                                    return fetch(event.request).then(
                                        function(response) {
                                            // Check if we received a valid response
                                            if(!response || response.status !== 200 || response.type !== 'basic') {
                                                return response;
                                            }
                                            
                                            // Clone the response
                                            var responseToCache = response.clone();
                                            
                                            caches.open(CACHE_NAME)
                                                .then(function(cache) {
                                                    cache.put(event.request, responseToCache);
                                                });
                                            
                                            return response;
                                        }
                                    );
                                })
                        );
                    });
                `))
                .then(function(registration) {
                    console.log('ServiceWorker registration successful with scope: ', registration.scope);
                })
                .catch(function(error) {
                    console.log('ServiceWorker registration failed: ', error);
                });
            });
        }

        // Simple vanilla JavaScript implementation
        class JapaneseVocabApp {
            constructor() {
                this.words = [
                    { id: 1, japanese: 'Áä¨', reading: '„ÅÑ„Å¨', english: 'dog', group: 'Animals' },
                    { id: 2, japanese: 'Áå´', reading: '„Å≠„Åì', english: 'cat', group: 'Animals' },
                    { id: 3, japanese: 'Ê∞¥', reading: '„Åø„Åö', english: 'water', group: 'Basic' },
                    { id: 4, japanese: 'È£ü„Åπ„Çã', reading: '„Åü„Åπ„Çã', english: 'to eat', group: 'Verbs' },
                    { id: 5, japanese: 'Êú¨', reading: '„Åª„Çì', english: 'book', group: 'Basic' },
                    { id: 6, japanese: 'Ëµ∞„Çã', reading: '„ÅØ„Åó„Çã', english: 'to run', group: 'Verbs' },
                    { id: 7, japanese: 'È≠ö', reading: '„Åï„Åã„Å™', english: 'fish', group: 'Animals' },
                    { id: 8, japanese: 'Ëªä', reading: '„Åè„Çã„Åæ', english: 'car', group: 'Basic' }
                ];
                this.currentView = 'home';
                this.selectedGroup = '';
                this.quizType = 'flashcard';
                this.studyWords = [];
                this.currentWordIndex = 0;
                this.showAnswer = false;
                this.score = { correct: 0, total: 0 };
                this.currentChoices = [];
                this.userAnswer = '';
                this.showResult = false;
                this.isCorrect = false;
                this.newWord = { japanese: '', reading: '', english: '', group: '' };
                this.editingWord = null;
                
                this.app = document.getElementById('app');
                this.loadData();
                this.render();
            }

            // Memory-based storage (since localStorage isn't available)
            saveData() {
                try {
                    this.savedWords = [...this.words];
                } catch (e) {
                    console.log('Storage not available');
                }
            }

            loadData() {
                try {
                    if (this.savedWords) {
                        this.words = [...this.savedWords];
                    }
                } catch (e) {
                    console.log('Storage not available');
                }
            }

            getGroups() {
                return [...new Set(this.words.map(word => word.group))];
            }

            render() {
                switch(this.currentView) {
                    case 'home':
                        this.renderHome();
                        break;
                    case 'add':
                        this.renderAddWord();
                        break;
                    case 'quiz-select':
                        this.renderQuizSelect();
                        break;
                    case 'quiz':
                        this.renderQuiz();
                        break;
                    case 'quiz-complete':
                        this.renderQuizComplete();
                        break;
                    default:
                        this.renderHome();
                }
            }

            renderHome() {
                const groups = this.getGroups();
                this.app.innerHTML = `
                    <div class="bg-gradient-to-r from-blue-500 to-purple-600 text-white p-6 rounded-b-3xl">
                        <h1 class="text-2xl font-bold text-center">Japanese Vocab</h1>
                        <p class="text-center opacity-90 mt-2">Learn with different quiz types</p>
                    </div>

                    <div class="p-4 grid grid-cols-2 gap-4">
                        <button onclick="app.showAddWord()" class="bg-green-500 text-white p-4 rounded-2xl flex flex-col items-center gap-2 shadow-lg active:scale-95 transition-transform">
                            <span class="text-2xl">‚ûï</span>
                            <span class="font-semibold">Add Word</span>
                        </button>
                        
                        <button onclick="app.showQuizSelect('random')" class="bg-blue-500 text-white p-4 rounded-2xl flex flex-col items-center gap-2 shadow-lg active:scale-95 transition-transform">
                            <span class="text-2xl">üß†</span>
                            <span class="font-semibold">Random Quiz</span>
                        </button>
                    </div>

                    <div class="p-4">
                        <h2 class="text-xl font-bold mb-4 flex items-center gap-2">
                            <span>üë•</span>
                            Study Groups
                        </h2>
                        <div class="grid gap-3">
                            ${groups.map(group => {
                                const groupWords = this.words.filter(word => word.group === group);
                                const emoji = group === 'Animals' ? 'üê±' : group === 'Basic' ? 'üìö' : 'üèÉ‚Äç‚ôÇÔ∏è';
                                return `
                                    <button onclick="app.showQuizSelect('${group}')" class="bg-gradient-to-r from-gray-50 to-gray-100 p-4 rounded-2xl text-left hover:from-blue-50 hover:to-purple-50 transition-colors border border-gray-200">
                                        <div class="flex justify-between items-center">
                                            <div>
                                                <h3 class="font-bold text-gray-800 text-lg">${group}</h3>
                                                <p class="text-gray-600">${groupWords.length} words</p>
                                            </div>
                                            <div class="text-2xl">${emoji}</div>
                                        </div>
                                    </button>
                                `;
                            }).join('')}
                        </div>
                    </div>

                    <div class="p-4">
                        <h2 class="text-xl font-bold mb-4 flex items-center gap-2">
                            <span>üìö</span>
                            Your Words (${this.words.length})
                        </h2>
                        <div class="space-y-3 max-h-96 overflow-y-auto">
                            ${this.words.slice(-5).reverse().map(word => `
                                <div class="bg-gray-50 p-4 rounded-2xl">
                                    <div class="flex justify-between items-start">
                                        <div class="flex-1">
                                            <div class="text-2xl font-bold text-gray-800">${word.japanese}</div>
                                            <div class="text-gray-600">${word.reading}</div>
                                            <div class="text-gray-700 font-medium">${word.english}</div>
                                            <div class="text-xs bg-blue-100 text-blue-800 px-2 py-1 rounded-full inline-block mt-2">${word.group}</div>
                                        </div>
                                        <div class="flex gap-2">
                                            <button onclick="app.editWord(${word.id})" class="text-blue-500 p-2 hover:bg-blue-100 rounded-full">‚úèÔ∏è</button>
                                            <button onclick="app.deleteWord(${word.id})" class="text-red-500 p-2 hover:bg-red-100 rounded-full">üóëÔ∏è</button>
                                        </div>
                                    </div>
                                </div>
                            `).join('')}
                        </div>
                    </div>
                `;
            }

            renderAddWord() {
                const groups = this.getGroups();
                this.app.innerHTML = `
                    <div class="bg-gradient-to-r from-green-500 to-blue-500 text-white p-6 rounded-b-3xl">
                        <button onclick="app.showHome()" class="mb-4 p-2 hover:bg-white/20 rounded-full">‚Üê Back</button>
                        <h1 class="text-2xl font-bold">${this.editingWord ? 'Edit Word' : 'Add New Word'}</h1>
                    </div>

                    <div class="p-6 space-y-6">
                        <div>
                            <label class="block text-gray-700 font-semibold mb-2">Japanese</label>
                            <input type="text" id="japanese" value="${this.newWord.japanese}" class="w-full p-4 text-2xl border-2 border-gray-300 rounded-2xl focus:border-blue-500 focus:outline-none" placeholder="Êº¢Â≠ó or „Å≤„Çâ„Åå„Å™">
                        </div>

                        <div>
                            <label class="block text-gray-700 font-semibold mb-2">Reading („Å≤„Çâ„Åå„Å™)</label>
                            <input type="text" id="reading" value="${this.newWord.reading}" class="w-full p-4 text-xl border-2 border-gray-300 rounded-2xl focus:border-blue-500 focus:outline-none" placeholder="„ÅÑ„Å¨">
                        </div>

                        <div>
                            <label class="block text-gray-700 font-semibold mb-2">English</label>
                            <input type="text" id="english" value="${this.newWord.english}" class="w-full p-4 text-xl border-2 border-gray-300 rounded-2xl focus:border-blue-500 focus:outline-none" placeholder="dog">
                        </div>

                        <div>
                            <label class="block text-gray-700 font-semibold mb-2">Group</label>
                            <select id="group" class="w-full p-4 text-lg border-2 border-gray-300 rounded-2xl focus:border-blue-500 focus:outline-none">
                                <option value="">Select a group</option>
                                ${groups.map(group => `<option value="${group}" ${this.newWord.group === group ? 'selected' : ''}>${group}</option>`).join('')}
                            </select>
                            <div class="flex gap-2 mt-2">
                                <input type="text" id="newGroup" class="flex-1 p-3 border-2 border-gray-300 rounded-xl focus:border-blue-500 focus:outline-none" placeholder="Or create new group">
                                <button onclick="app.addNewGroup()" class="px-4 py-3 bg-blue-500 text-white rounded-xl font-semibold active:scale-95 transition-transform">Add</button>
                            </div>
                        </div>

                        <button onclick="app.saveWord()" class="w-full bg-gradient-to-r from-green-500 to-blue-500 text-white p-4 rounded-2xl font-bold text-xl active:scale-95 transition-transform shadow-lg">
                            ${this.editingWord ? 'Update Word' : 'Add Word'}
                        </button>
                    </div>
                `;
            }

            renderQuizSelect() {
                this.app.innerHTML = `
                    <div class="bg-gradient-to-r from-blue-500 to-purple-600 text-white p-6 rounded-b-3xl">
                        <button onclick="app.showHome()" class="mb-4 p-2 hover:bg-white/20 rounded-full">‚Üê Back</button>
                        <h1 class="text-2xl font-bold">Choose Quiz Type</h1>
                        <p class="opacity-90 mt-2">${this.selectedGroup === 'random' ? 'Random words from all groups' : `Group: ${this.selectedGroup}`}</p>
                    </div>

                    <div class="p-6 space-y-4">
                        <button onclick="app.startQuiz('flashcard')" class="w-full bg-gradient-to-r from-orange-400 to-red-500 text-white p-6 rounded-2xl text-left shadow-lg active:scale-95 transition-transform">
                            <div class="flex items-center gap-4">
                                <span class="text-4xl">üìñ</span>
                                <div>
                                    <h3 class="text-xl font-bold">Flashcards</h3>
                                    <p class="text-sm opacity-90">See Japanese ‚Üí Reveal English</p>
                                </div>
                            </div>
                        </button>

                        <button onclick="app.startQuiz('multiple-choice')" class="w-full bg-gradient-to-r from-green-400 to-blue-500 text-white p-6 rounded-2xl text-left shadow-lg active:scale-95 transition-transform">
                            <div class="flex items-center gap-4">
                                <span class="text-4xl">üéØ</span>
                                <div>
                                    <h3 class="text-xl font-bold">Multiple Choice</h3>
                                    <p class="text-sm opacity-90">Choose the correct translation</p>
                                </div>
                            </div>
                        </button>

                        <button onclick="app.startQuiz('write-translation')" class="w-full bg-gradient-to-r from-purple-400 to-pink-500 text-white p-6 rounded-2xl text-left shadow-lg active:scale-95 transition-transform">
                            <div class="flex items-center gap-4">
                                <span class="text-4xl">‚úçÔ∏è</span>
                                <div>
                                    <h3 class="text-xl font-bold">Write Translation</h3>
                                    <p class="text-sm opacity-90">Type the English meaning</p>
                                </div>
                            </div>
                        </button>
                    </div>
                `;
            }

            renderQuiz() {
                if (this.studyWords.length === 0) return;
                
                const currentWord = this.studyWords[this.currentWordIndex];
                const quizTypeEmoji = this.quizType === 'flashcard' ? 'üîÑ' : this.quizType === 'multiple-choice' ? 'üéØ' : '‚úçÔ∏è';
                const quizTypeName = this.quizType === 'flashcard' ? 'Flashcard' : this.quizType === 'multiple-choice' ? 'Multiple Choice' : 'Write Translation';

                let quizContent = '';
                
                if (this.quizType === 'flashcard') {
                    if (!this.showAnswer) {
                        quizContent = `
                            <button onclick="app.showAnswer()" class="w-full bg-gradient-to-r from-blue-500 to-purple-500 text-white p-4 rounded-2xl font-bold text-xl active:scale-95 transition-transform">
                                Show Answer
                            </button>
                        `;
                    } else {
                        quizContent = `
                            <div class="space-y-4">
                                <div class="bg-blue-50 p-4 rounded-2xl text-center">
                                    <div class="text-2xl font-bold text-blue-800">${currentWord.english}</div>
                                </div>
                                <div class="grid grid-cols-2 gap-3">
                                    <button onclick="app.markIncorrect()" class="bg-red-500 text-white p-3 rounded-xl font-semibold active:scale-95 transition-transform">‚ùå Incorrect</button>
                                    <button onclick="app.markCorrect()" class="bg-green-500 text-white p-3 rounded-xl font-semibold active:scale-95 transition-transform">‚úÖ Correct</button>
                                </div>
                            </div>
                        `;
                    }
                } else if (this.quizType === 'multiple-choice') {
                    if (!this.showResult) {
                        quizContent = `
                            <p class="text-center text-gray-600 mb-4">Choose the correct translation:</p>
                            ${this.currentChoices.map((choice, index) => `
                                <button onclick="app.checkAnswer('${choice.english.replace(/'/g, "\\'")}')" class="w-full bg-gray-100 hover:bg-gray-200 p-4 rounded-xl text-left font-medium active:scale-95 transition-transform mb-3">
                                    ${choice.english}
                                </button>
                            `).join('')}
                        `;
                    } else {
                        quizContent = `
                            <div class="space-y-4">
                                <div class="p-4 rounded-2xl text-center ${this.isCorrect ? 'bg-green-100' : 'bg-red-100'}">
                                    <div class="text-xl font-bold ${this.isCorrect ? 'text-green-800' : 'text-red-800'}">
                                        ${this.isCorrect ? '‚úÖ Correct!' : '‚ùå Incorrect'}
                                    </div>
                                    <div class="text-lg mt-2 text-gray-700">
                                        Answer: <strong>${currentWord.english}</strong>
                                    </div>
                                </div>
                                <button onclick="app.nextQuestion()" class="w-full bg-blue-500 text-white p-3 rounded-xl font-semibold active:scale-95 transition-transform">Next Question</button>
                            </div>
                        `;
                    }
                } else if (this.quizType === 'write-translation') {
                    if (!this.showResult) {
                        quizContent = `
                            <p class="text-center text-gray-600 mb-4">Write the English translation:</p>
                            <input type="text" id="userAnswer" value="${this.userAnswer}" class="w-full p-4 text-lg border-2 border-gray-300 rounded-2xl focus:border-blue-500 focus:outline-none mb-4" placeholder="Type your answer here...">
                            <button onclick="app.checkWrittenAnswer()" class="w-full bg-blue-500 text-white p-3 rounded-xl font-semibold active:scale-95 transition-transform">Check Answer</button>
                        `;
                    } else {
                        quizContent = `
                            <div class="space-y-4">
                                <div class="p-4 rounded-2xl text-center ${this.isCorrect ? 'bg-green-100' : 'bg-red-100'}">
                                    <div class="text-xl font-bold ${this.isCorrect ? 'text-green-800' : 'text-red-800'}">
                                        ${this.isCorrect ? '‚úÖ Correct!' : '‚ùå Incorrect'}
                                    </div>
                                    <div class="text-lg mt-2 text-gray-700">
                                        Your answer: <strong>${this.userAnswer}</strong>
                                    </div>
                                    <div class="text-lg text-gray-700">
                                        Correct answer: <strong>${currentWord.english}</strong>
                                    </div>
                                </div>
                                <button onclick="app.nextQuestion()" class="w-full bg-blue-500 text-white p-3 rounded-xl font-semibold active:scale-95 transition-transform">Next Question</button>
                            </div>
                        `;
                    }
                }

                this.app.innerHTML = `
                    <div class="bg-gradient-to-r from-orange-500 to-red-500 text-white p-6 rounded-b-3xl">
                        <button onclick="app.showHome()" class="mb-4 p-2 hover:bg-white/20 rounded-full">‚Üê Back</button>
                        <div class="flex justify-between items-center">
                            <div>
                                <h1 class="text-xl font-bold">${quizTypeEmoji} ${quizTypeName}</h1>
                                <p class="text-sm opacity-90">${this.selectedGroup === 'random' ? 'Random Quiz' : this.selectedGroup}</p>
                            </div>
                            <div class="text-right">
                                <div class="bg-white/20 px-3 py-1 rounded-full text-sm">
                                    ${this.currentWordIndex + 1}/${this.studyWords.length}
                                </div>
                                <div class="text-xs mt-1">Score: ${this.score.correct}/${this.score.total}</div>
                            </div>
                        </div>
                    </div>

                    <div class="p-6">
                        <div class="bg-gray-50 p-6 rounded-3xl mb-6 text-center">
                            <div class="text-5xl font-bold text-gray-800 mb-3">${currentWord.japanese}</div>
                            <div class="text-2xl text-gray-600">${currentWord.reading}</div>
                        </div>
                        ${quizContent}
                    </div>
                `;
            }

            renderQuizComplete() {
                const percentage = this.score.total > 0 ? Math.round((this.score.correct / this.score.total) * 100) : 0;
                const emoji = percentage >= 80 ? 'üåü' : percentage >= 60 ? 'üëç' : 'üìö';
                const message = percentage >= 80 ? 'Excellent work!' : percentage >= 60 ? 'Good job!' : 'Keep practicing!';

                this.app.innerHTML = `
                    <div class="bg-gradient-to-r from-green-500 to-blue-500 text-white p-6 rounded-b-3xl">
                        <h1 class="text-2xl font-bold text-center">Quiz Complete! üéâ</h1>
                    </div>

                    <div class="p-8 text-center">
                        <div class="bg-gray-50 p-8 rounded-3xl mb-8">
                            <div class="text-6xl mb-4">${emoji}</div>
                            <div class="text-4xl font-bold text-gray-800 mb-2">${percentage}%</div>
                            <div class="text-xl text-gray-600 mb-4">${this.score.correct} out of ${this.score.total} correct</div>
                            <div class="text-lg text-gray-700">${message}</div>
                        </div>
                        <div class="space-y-3">
                            <button onclick="app.startQuiz('${this.quizType}')" class="w-full bg-gradient-to-r from-blue-500 to-purple-500 text-white p-4 rounded-2xl font-bold text-lg active:scale-95 transition-transform">Try Again</button>
                            <button onclick="app.showHome()" class="w-full bg-gray-500 text-white p-4 rounded-2xl font-bold text-lg active:scale-95 transition-transform">Back to Home</button>
                        </div>
                    </div>
                `;
            }

            // Navigation methods
            showHome() {
                this.currentView = 'home';
                this.render();
            }

            showAddWord() {
                this.currentView = 'add';
                this.newWord = { japanese: '', reading: '', english: '', group: '' };
                this.editingWord = null;
                this.render();
            }

            showQuizSelect(group) {
                this.selectedGroup = group;
                this.currentView = 'quiz-select';
                this.render();
            }

            // Word management methods
            saveWord() {
                const japanese = document.getElementById('japanese').value.trim();
                const reading = document.getElementById('reading').value.trim();
                const english = document.getElementById('english').value.trim();
                const group = document.getElementById('group').value.trim();

                if (!japanese || !reading || !english || !group) {
                    alert('Please fill in all fields');
                    return;
                }

                if (this.editingWord) {
                    const index = this.words.findIndex(w => w.id === this.editingWord.id);
                    this.words[index] = { ...this.editingWord, japanese, reading, english, group };
                } else {
                    this.words.push({ id: Date.now(), japanese, reading, english, group });
                }

                this.saveData();
                this.showHome();
            }

            editWord(id) {
                this.editingWord = this.words.find(w => w.id === id);
                this.newWord = { ...this.editingWord };
                this.currentView = 'add';
                this.render();
            }

            deleteWord(id) {
                if (confirm('Are you sure you want to delete this word?')) {
                    this.words = this.words.filter(w => w.id !== id);
                    this.saveData();
                    this.render();
                }
            }

            addNewGroup() {
                const newGroup = document.getElementById('newGroup').value.trim();
                if (newGroup) {
                    document.getElementById('group').value = newGroup;
                    document.getElementById('newGroup').value = '';
                }
            }

            // Quiz methods
            startQuiz(type) {
                this.quizType = type;
                this.currentWordIndex = 0;
                this.showAnswer = false;
                this.showResult = false;
                this.score = { correct: 0, total: 0 };
                this.userAnswer = '';

                if (this.selectedGroup === 'random') {
                    this.studyWords = [...this.words].sort(() => Math.random() - 0.5).slice(0, Math.min(10, this.words.length));
                } else {
                    this.studyWords = this.words.filter(w => w.group === this.selectedGroup).sort(() => Math.random() - 0.5);
                }

                if (this.studyWords.length === 0) {
                    alert('No words found in this group!');
                    return;
                }

                if (type === 'multiple-choice') {
                    this.generateChoices();
                }

                this.currentView = 'quiz';
                this.render();
            }

            generateChoices() {
                const currentWord = this.studyWords[this.currentWordIndex];
                const otherWords = this.words.filter(w => w.id !== currentWord.id);
                const shuffled = otherWords.sort(() => Math.random() - 0.5);
                const choices = shuffled.slice(0, 3);
                choices.push(currentWord);
                this.currentChoices = choices.sort(() => Math.random() - 0.5);
            }

            showAnswer() {
                this.showAnswer = true;
                this.render();
            }

            markCorrect() {
                this.score.correct++;
                this.score.total++;
                this.nextQuestion();
            }

            markIncorrect() {
                this.score.total++;
                this.nextQuestion();
            }

            checkAnswer(selectedAnswer) {
                const currentWord = this.studyWords[this.currentWordIndex];
                this.isCorrect = selectedAnswer === currentWord.english;
                this.showResult = true;
                this.score.total++;
                if (this.isCorrect) this.score.correct++;
                this.render();
            }

            checkWrittenAnswer() {
                this.userAnswer = document.getElementById('userAnswer').value.trim();
                if (!this.userAnswer) return;
                
                const currentWord = this.studyWords[this.currentWordIndex];
                this.isCorrect = this.userAnswer.toLowerCase() === currentWord.english.toLowerCase();
                this.showResult = true;
                this.score.total++;
                if (this.isCorrect) this.score.correct++;
                this.render();
            }

            nextQuestion() {
                if (this.currentWordIndex < this.studyWords.length - 1) {
                    this.currentWordIndex++;
                    this.showAnswer = false;
                    this.showResult = false;
                    this.userAnswer = '';
                    
                    if (this.quizType === 'multiple-choice') {
                        this.generateChoices();
                    }
                    
                    this.render();
                } else {
                    this.currentView = 'quiz-complete';
                    this.render();
                }
            }
        }

        // Initialize the app
        const app = new JapaneseVocabApp();
    </script>
</body>
</html>
