<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Japanese Vocab App</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <meta name="description" content="Learn Japanese vocabulary with flashcards, multiple choice, and writing exercises">
    <meta name="theme-color" content="#3B82F6">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta name="apple-mobile-web-app-title" content="Japanese Vocab">
</head>
<body class="bg-gray-100">
    <div id="app" class="max-w-md mx-auto bg-white min-h-screen">
        <div class="p-8 text-center">
            <div class="text-2xl">Loading...</div>
        </div>
    </div>

    <script>
        function createIcon(size) {
            const canvas = document.createElement('canvas');
            const ctx = canvas.getContext('2d');
            canvas.width = size;
            canvas.height = size;
            
            const gradient = ctx.createLinearGradient(0, 0, size, size);
            gradient.addColorStop(0, '#3B82F6');
            gradient.addColorStop(1, '#8B35FF');
            
            const radius = size * 0.125;
            ctx.fillStyle = gradient;
            ctx.beginPath();
            ctx.roundRect(0, 0, size, size, radius);
            ctx.fill();
            
            ctx.fillStyle = 'white';
            ctx.font = 'bold ' + (size * 0.3) + 'px system-ui';
            ctx.textAlign = 'center';
            ctx.textBaseline = 'middle';
            ctx.fillText('Êó•', size/2, size/2);
            
            return canvas.toDataURL('image/png');
        }
        
        const icon192 = createIcon(192);
        const icon512 = createIcon(512);
        
        const manifest = {
            "id": "japanese-vocab-app",
            "name": "Japanese Vocabulary App",
            "short_name": "JP Vocab",
            "description": "Learn Japanese vocabulary",
            "start_url": "./",
            "display": "standalone",
            "background_color": "#ffffff",
            "theme_color": "#3B82F6",
            "orientation": "portrait-primary",
            "icons": [
                {"src": icon192, "sizes": "192x192", "type": "image/png"},
                {"src": icon512, "sizes": "512x512", "type": "image/png"}
            ]
        };

        const manifestBlob = new Blob([JSON.stringify(manifest)], {type: 'application/json'});
        const manifestURL = URL.createObjectURL(manifestBlob);
        
        const manifestLink = document.createElement('link');
        manifestLink.rel = 'manifest';
        manifestLink.href = manifestURL;
        document.head.appendChild(manifestLink);
        
        const favicon = document.createElement('link');
        favicon.rel = 'icon';
        favicon.type = 'image/png';
        favicon.href = icon192;
        document.head.appendChild(favicon);

        class JapaneseVocabApp {
            constructor() {
                this.words = [
                    { id: 1, japanese: 'Áä¨', reading: '„ÅÑ„Å¨', english: 'dog', group: 'Animals' },
                    { id: 2, japanese: 'Áå´', reading: '„Å≠„Åì', english: 'cat', group: 'Animals' },
                    { id: 3, japanese: 'Ê∞¥', reading: '„Åø„Åö', english: 'water', group: 'Basic' },
                    { id: 4, japanese: 'È£ü„Åπ„Çã', reading: '„Åü„Åπ„Çã', english: 'to eat', group: 'Verbs' },
                    { id: 5, japanese: 'Êú¨', reading: '„Åª„Çì', english: 'book', group: 'Basic' },
                    { id: 6, japanese: 'Ëµ∞„Çã', reading: '„ÅØ„Åó„Çã', english: 'to run', group: 'Verbs' },
                    { id: 7, japanese: 'È≠ö', reading: '„Åï„Åã„Å™', english: 'fish', group: 'Animals' },
                    { id: 8, japanese: 'Ëªä', reading: '„Åè„Çã„Åæ', english: 'car', group: 'Basic' }
                ];
                this.currentView = 'home';
                this.selectedGroup = '';
                this.quizType = 'flashcard';
                this.studyWords = [];
                this.currentWordIndex = 0;
                this.showAnswer = false;
                this.score = { correct: 0, total: 0 };
                this.currentChoices = [];
                this.userAnswer = '';
                this.showResult = false;
                this.isCorrect = false;
                this.newWord = { japanese: '', reading: '', english: '', group: '' };
                this.editingWord = null;
                
                this.app = document.getElementById('app');
                this.loadData();
                this.render();
            }

            saveData() {
                try {
                    localStorage.setItem('japaneseVocabWords', JSON.stringify(this.words));
                } catch (e) {
                    console.log('Storage not available');
                }
            }

            loadData() {
                try {
                    const saved = localStorage.getItem('japaneseVocabWords');
                    if (saved) {
                        this.words = JSON.parse(saved);
                    }
                } catch (e) {
                    console.log('Storage not available');
                }
            }

            getGroups() {
                return [...new Set(this.words.map(word => word.group))];
            }

            render() {
                switch(this.currentView) {
                    case 'home':
                        this.renderHome();
                        break;
                    case 'add':
                        this.renderAddWord();
                        break;
                    case 'import':
                        this.renderImport();
                        break;
                    case 'quiz-select':
                        this.renderQuizSelect();
                        break;
                    case 'quiz':
                        this.renderQuiz();
                        break;
                    case 'quiz-complete':
                        this.renderQuizComplete();
                        break;
                    default:
                        this.renderHome();
                }
            }

            renderHome() {
                const groups = this.getGroups();
                this.app.innerHTML = `
                    <div class="bg-gradient-to-r from-blue-500 to-purple-600 text-white p-6 rounded-b-3xl">
                        <h1 class="text-2xl font-bold text-center">Japanese Vocab</h1>
                        <p class="text-center opacity-90 mt-2">Learn with different quiz types</p>
                    </div>

                    <div class="p-4 grid grid-cols-2 gap-4">
                        <button onclick="app.showAddWord()" class="bg-green-500 text-white p-4 rounded-2xl flex flex-col items-center gap-2 shadow-lg active:scale-95 transition-transform">
                            <span class="text-2xl">‚ûï</span>
                            <span class="font-semibold">Add Word</span>
                        </button>
                        
                        <button onclick="app.showQuizSelect('random')" class="bg-blue-500 text-white p-4 rounded-2xl flex flex-col items-center gap-2 shadow-lg active:scale-95 transition-transform">
                            <span class="text-2xl">üß†</span>
                            <span class="font-semibold">Random Quiz</span>
                        </button>
                    </div>

                    <div class="p-4 grid grid-cols-2 gap-4">
                        <button onclick="app.exportWords()" class="bg-purple-500 text-white p-4 rounded-2xl flex flex-col items-center gap-2 shadow-lg active:scale-95 transition-transform">
                            <span class="text-2xl">üì§</span>
                            <span class="font-semibold">Export</span>
                        </button>
                        
                        <button onclick="app.showImport()" class="bg-orange-500 text-white p-4 rounded-2xl flex flex-col items-center gap-2 shadow-lg active:scale-95 transition-transform">
                            <span class="text-2xl">üì•</span>
                            <span class="font-semibold">Import</span>
                        </button>
                    </div>

                    <div class="p-4">
                        <h2 class="text-xl font-bold mb-4">Study Groups</h2>
                        <div class="grid gap-3">
                            ${groups.map(group => {
                                const groupWords = this.words.filter(word => word.group === group);
                                let groupEmoji = 'üìö';
                                if (group === 'Animals') groupEmoji = 'üê±';
                                if (group.includes('Verbs')) groupEmoji = 'üèÉ‚Äç‚ôÇÔ∏è';
                                
                                return `
                                    <button onclick="app.showQuizSelect('${group}')" class="bg-gradient-to-r from-gray-50 to-gray-100 p-4 rounded-2xl text-left hover:from-blue-50 hover:to-purple-50 transition-colors border border-gray-200">
                                        <div class="flex justify-between items-center">
                                            <div>
                                                <h3 class="font-bold text-gray-800 text-lg">${group}</h3>
                                                <p class="text-gray-600">${groupWords.length} words</p>
                                            </div>
                                            <div class="text-2xl">${groupEmoji}</div>
                                        </div>
                                    </button>
                                `;
                            }).join('')}
                        </div>
                    </div>

                    <div class="p-4">
                        <h2 class="text-xl font-bold mb-4">Your Words (${this.words.length})</h2>
                        <div class="space-y-3 max-h-96 overflow-y-auto">
                            ${this.words.slice(-5).reverse().map(word => `
                                <div class="bg-gray-50 p-4 rounded-2xl">
                                    <div class="flex justify-between items-start">
                                        <div class="flex-1">
                                            <div class="text-2xl font-bold text-gray-800">${word.japanese}</div>
                                            <div class="text-gray-600">${word.reading}</div>
                                            <div class="text-gray-700 font-medium">${word.english}</div>
                                            <div class="text-xs bg-blue-100 text-blue-800 px-2 py-1 rounded-full inline-block mt-2">${word.group}</div>
                                        </div>
                                        <div class="flex gap-2">
                                            <button onclick="app.editWord(${word.id})" class="text-blue-500 p-2 hover:bg-blue-100 rounded-full">‚úèÔ∏è</button>
                                            <button onclick="app.deleteWord(${word.id})" class="text-red-500 p-2 hover:bg-red-100 rounded-full">üóëÔ∏è</button>
                                        </div>
                                    </div>
                                </div>
                            `).join('')}
                        </div>
                    </div>
                `;
            }

            renderAddWord() {
                const groups = this.getGroups();
                this.app.innerHTML = `
                    <div class="bg-gradient-to-r from-green-500 to-blue-500 text-white p-6 rounded-b-3xl">
                        <button onclick="app.showHome()" class="mb-4 p-2 hover:bg-white/20 rounded-full">‚Üê Back</button>
                        <h1 class="text-2xl font-bold">${this.editingWord ? 'Edit Word' : 'Add New Word'}</h1>
                    </div>

                    <div class="p-6 space-y-6">
                        <div>
                            <label class="block text-gray-700 font-semibold mb-2">Japanese</label>
                            <input type="text" id="japanese" value="${this.newWord.japanese}" class="w-full p-4 text-2xl border-2 border-gray-300 rounded-2xl focus:border-blue-500 focus:outline-none" placeholder="Êº¢Â≠ó or „Å≤„Çâ„Åå„Å™">
                        </div>

                        <div>
                            <label class="block text-gray-700 font-semibold mb-2">Reading</label>
                            <input type="text" id="reading" value="${this.newWord.reading}" class="w-full p-4 text-xl border-2 border-gray-300 rounded-2xl focus:border-blue-500 focus:outline-none" placeholder="„ÅÑ„Å¨">
                        </div>

                        <div>
                            <label class="block text-gray-700 font-semibold mb-2">English</label>
                            <input type="text" id="english" value="${this.newWord.english}" class="w-full p-4 text-xl border-2 border-gray-300 rounded-2xl focus:border-blue-500 focus:outline-none" placeholder="dog">
                        </div>

                        <div>
                            <label class="block text-gray-700 font-semibold mb-2">Group</label>
                            <select id="group" class="w-full p-4 text-lg border-2 border-gray-300 rounded-2xl focus:border-blue-500 focus:outline-none">
                                <option value="">Select a group</option>
                                ${groups.map(group => `<option value="${group}" ${this.newWord.group === group ? 'selected' : ''}>${group}</option>`).join('')}
                            </select>
                            <div class="flex gap-2 mt-2">
                                <input type="text" id="newGroup" class="flex-1 p-3 border-2 border-gray-300 rounded-xl focus:border-blue-500 focus:outline-none" placeholder="Or create new group">
                                <button onclick="app.addNewGroup()" class="px-4 py-3 bg-blue-500 text-white rounded-xl font-semibold active:scale-95 transition-transform">Add</button>
                            </div>
                        </div>

                        <button onclick="app.saveWord()" class="w-full bg-gradient-to-r from-green-500 to-blue-500 text-white p-4 rounded-2xl font-bold text-xl active:scale-95 transition-transform shadow-lg">
                            ${this.editingWord ? 'Update Word' : 'Add Word'}
                        </button>
                    </div>
                `;
            }

            renderImport() {
                this.app.innerHTML = `
                    <div class="bg-gradient-to-r from-orange-500 to-red-500 text-white p-6 rounded-b-3xl">
                        <button onclick="app.showHome()" class="mb-4 p-2 hover:bg-white/20 rounded-full">‚Üê Back</button>
                        <h1 class="text-2xl font-bold">Import Words</h1>
                    </div>

                    <div class="p-6 space-y-6">
                        <div>
                            <h2 class="text-lg font-bold mb-3">Import from File</h2>
                            <input type="file" id="importFile" accept=".json,.txt" class="w-full p-3 border-2 border-gray-300 rounded-xl focus:border-blue-500 focus:outline-none">
                            <button onclick="app.importFromFile()" class="w-full mt-2 bg-blue-500 text-white p-3 rounded-xl font-semibold active:scale-95 transition-transform">Import File</button>
                        </div>

                        <div class="border-t pt-6">
                            <h2 class="text-lg font-bold mb-3">Import from Text</h2>
                            <textarea id="importText" rows="6" class="w-full p-3 border-2 border-gray-300 rounded-xl focus:border-blue-500 focus:outline-none" placeholder="Format: Áä¨Ôºà„ÅÑ„Å¨Ôºâ - dog"></textarea>
                            <div class="flex gap-2 mt-2">
                                <input type="text" id="importGroup" value="Imported" class="flex-1 p-3 border-2 border-gray-300 rounded-xl focus:border-blue-500 focus:outline-none" placeholder="Group name">
                                <button onclick="app.importFromText()" class="px-6 py-3 bg-green-500 text-white rounded-xl font-semibold active:scale-95 transition-transform">Import</button>
                            </div>
                        </div>

                        <div class="border-t pt-6">
                            <h2 class="text-lg font-bold mb-3">Quick Import: Genki I Lesson 1</h2>
                            <button onclick="app.importGenkiLesson1()" class="w-full bg-gradient-to-r from-purple-500 to-pink-500 text-white p-4 rounded-xl font-semibold active:scale-95 transition-transform">
                                Import 48 Genki I Words
                            </button>
                        </div>
                    </div>
                `;
            }

            renderQuizSelect() {
                this.app.innerHTML = `
                    <div class="bg-gradient-to-r from-blue-500 to-purple-600 text-white p-6 rounded-b-3xl">
                        <button onclick="app.showHome()" class="mb-4 p-2 hover:bg-white/20 rounded-full">‚Üê Back</button>
                        <h1 class="text-2xl font-bold">Choose Quiz Type</h1>
                        <p class="opacity-90 mt-2">${this.selectedGroup === 'random' ? 'Random words from all groups' : 'Group: ' + this.selectedGroup}</p>
                    </div>

                    <div class="p-6 space-y-4">
                        <button onclick="app.startQuiz('flashcard')" class="w-full bg-gradient-to-r from-orange-400 to-red-500 text-white p-6 rounded-2xl text-left shadow-lg active:scale-95 transition-transform">
                            <div class="flex items-center gap-4">
                                <span class="text-4xl">üìñ</span>
                                <div>
                                    <h3 class="text-xl font-bold">Flashcards</h3>
                                    <p class="text-sm opacity-90">See Japanese ‚Üí Reveal English</p>
                                </div>
                            </div>
                        </button>

                        <button onclick="app.startQuiz('multiple-choice')" class="w-full bg-gradient-to-r from-green-400 to-blue-500 text-white p-6 rounded-2xl text-left shadow-lg active:scale-95 transition-transform">
                            <div class="flex items-center gap-4">
                                <span class="text-4xl">üéØ</span>
                                <div>
                                    <h3 class="text-xl font-bold">Multiple Choice</h3>
                                    <p class="text-sm opacity-90">Choose the correct translation</p>
                                </div>
                            </div>
                        </button>

                        <button onclick="app.startQuiz('write-translation')" class="w-full bg-gradient-to-r from-purple-400 to-pink-500 text-white p-6 rounded-2xl text-left shadow-lg active:scale-95 transition-transform">
                            <div class="flex items-center gap-4">
                                <span class="text-4xl">‚úçÔ∏è</span>
                                <div>
                                    <h3 class="text-xl font-bold">Write Translation</h3>
                                    <p class="text-sm opacity-90">Type the English meaning</p>
                                </div>
                            </div>
                        </button>
                    </div>
                `;
            }

            renderQuiz() {
                if (this.studyWords.length === 0) return;
                
                const currentWord = this.studyWords[this.currentWordIndex];
                let quizTypeEmoji = 'üìñ';
                let quizTypeName = 'Flashcard';
                
                if (this.quizType === 'multiple-choice') {
                    quizTypeEmoji = 'üéØ';
                    quizTypeName = 'Multiple Choice';
                } else if (this.quizType === 'write-translation') {
                    quizTypeEmoji = '‚úçÔ∏è';
                    quizTypeName = 'Write Translation';
                }

                let quizContent = '';
                
                if (this.quizType === 'flashcard') {
                    if (!this.showAnswer) {
                        quizContent = `
                            <div class="space-y-6">
                                <div class="text-center">
                                    <p class="text-gray-600 text-lg mb-4">What does this mean?</p>
                                    <div class="bg-blue-50 p-6 rounded-3xl mb-6">
                                        <div class="text-xl text-blue-800">${currentWord.reading}</div>
                                    </div>
                                </div>
                                <button onclick="app.showAnswerFlashcard()" class="w-full bg-gradient-to-r from-blue-500 to-purple-500 text-white p-4 rounded-2xl font-bold text-xl active:scale-95 transition-transform">
                                    Show Answer
                                </button>
                            </div>
                        `;
                    } else {
                        quizContent = `
                            <div class="space-y-6">
                                <div class="bg-green-50 p-6 rounded-3xl text-center">
                                    <div class="text-2xl font-bold text-green-800 mb-2">${currentWord.english}</div>
                                    <div class="text-lg text-green-600">${currentWord.reading}</div>
                                </div>
                                <p class="text-center text-gray-600">Did you get it right?</p>
                                <div class="grid grid-cols-2 gap-3">
                                    <button onclick="app.markIncorrect()" class="bg-red-500 text-white p-4 rounded-xl font-semibold active:scale-95 transition-transform">‚ùå Incorrect</button>
                                    <button onclick="app.markCorrect()" class="bg-green-500 text-white p-4 rounded-xl font-semibold active:scale-95 transition-transform">‚úÖ Correct</button>
                                </div>
                            </div>
                        `;
                    }
                } else if (this.quizType === 'multiple-choice') {
                    if (!this.showResult) {
                        quizContent = `
                            <div class="space-y-4">
                                <p class="text-center text-gray-600 mb-4">Choose the correct translation:</p>
                                ${this.currentChoices.map(choice => `
                                    <button onclick="app.checkAnswer('${choice.english.replace(/'/g, "\\\'")}')" class="w-full bg-gray-100 hover:bg-gray-200 p-4 rounded-xl text-left font-medium active:scale-95 transition-transform">
                                        ${choice.english}
                                    </button>
                                `).join('')}
                            </div>
                        `;
                    } else {
                        const resultClass = this.isCorrect ? 'bg-green-100' : 'bg-red-100';
                        const resultTextClass = this.isCorrect ? 'text-green-800' : 'text-red-800';
                        const resultText = this.isCorrect ? '‚úÖ Correct!' : '‚ùå Incorrect';
                        
                        quizContent = `
                            <div class="space-y-4">
                                <div class="p-4 rounded-2xl text-center ${resultClass}">
                                    <div class="text-xl font-bold ${resultTextClass}">
                                        ${resultText}
                                    </div>
                                    <div class="text-lg mt-2 text-gray-700">
                                        Answer: <strong>${currentWord.english}</strong>
                                    </div>
                                </div>
                                <button onclick="app.nextQuestion()" class="w-full bg-blue-500 text-white p-3 rounded-xl font-semibold active:scale-95 transition-transform">Next Question</button>
                            </div>
                        `;
                    }
                } else if (this.quizType === 'write-translation') {
                    if (!this.showResult) {
                        quizContent = `
                            <div class="space-y-4">
                                <p class="text-center text-gray-600 mb-4">Write the English translation:</p>
                                <input type="text" id="userAnswer" value="${this.userAnswer}" class="w-full p-4 text-lg border-2 border-gray-300 rounded-2xl focus:border-blue-500 focus:outline-none mb-4" placeholder="Type your answer here..." onkeypress="if(event.key==='Enter') app.checkWrittenAnswer()">
                                <button onclick="app.checkWrittenAnswer()" class="w-full bg-blue-500 text-white p-3 rounded-xl font-semibold active:scale-95 transition-transform">Check Answer</button>
                            </div>
                        `;
                    } else {
                        const resultClass = this.isCorrect ? 'bg-green-100' : 'bg-red-100';
                        const resultTextClass = this.isCorrect ? 'text-green-800' : 'text-red-800';
                        const resultText = this.isCorrect ? '‚úÖ Correct!' : '‚ùå Incorrect';
                        
                        quizContent = `
                            <div class="space-y-4">
                                <div class="p-4 rounded-2xl text-center ${resultClass}">
                                    <div class="text-xl font-bold ${resultTextClass}">
                                        ${resultText}
                                    </div>
                                    <div class="text-lg mt-2 text-gray-700">
                                        Your answer: <strong>${this.userAnswer}</strong>
                                    </div>
                                    <div class="text-lg text-gray-700">
                                        Correct answer: <strong>${currentWord.english}</strong>
                                    </div>
                                </div>
                                <button onclick="app.nextQuestion()" class="w-full bg-blue-500 text-white p-3 rounded-xl font-semibold active:scale-95 transition-transform">Next Question</button>
                            </div>
                        `;
                    }
                }

                this.app.innerHTML = `
                    <div class="bg-gradient-to-r from-orange-500 to-red-500 text-white p-6 rounded-b-3xl">
                        <button onclick="app.showHome()" class="mb-4 p-2 hover:bg-white/20 rounded-full">‚Üê Back</button>
                        <div class="flex justify-between items-center">
                            <div>
                                <h1 class="text-xl font-bold">${quizTypeEmoji} ${quizTypeName}</h1>
                                <p class="text-sm opacity-90">${this.selectedGroup === 'random' ? 'Random Quiz' : this.selectedGroup}</p>
                            </div>
                            <div class="text-right">
                                <div class="bg-white/20 px-3 py-1 rounded-full text-sm">
                                    ${this.currentWordIndex + 1}/${this.studyWords.length}
                                </div>
                                <div class="text-xs mt-1">Score: ${this.score.correct}/${this.score.total}</div>
                            </div>
                        </div>
                    </div>

                    <div class="p-6">
                        <div class="bg-gray-50 p-6 rounded-3xl mb-6 text-center">
                            <div class="text-5xl font-bold text-gray-800 mb-3">${currentWord.japanese}</div>
                            ${this.quizType !== 'flashcard' ? '<div class="text-2xl text-gray-600">' + currentWord.reading + '</div>' : ''}
                        </div>
                        ${quizContent}
                    </div>
                `;

                if (this.quizType === 'write-translation' && !this.showResult) {
                    setTimeout(() => {
                        const input = document.getElementById('userAnswer');
                        if (input) input.focus();
                    }, 100);
                }
            }

            renderQuizComplete() {
                let percentage = 0;
                if (this.score.total > 0) {
                    percentage = Math.round((this.score.correct / this.score.total) * 100);
                }
                
                let resultEmoji = 'üìö';
                let message = 'Keep practicing!';
                
                if (percentage >= 80) {
                    resultEmoji = 'üåü';
                    message = 'Excellent work!';
                } else if (percentage >= 60) {
                    resultEmoji = 'üëç';
                    message = 'Good job!';
                }

                this.app.innerHTML = `
                    <div class="bg-gradient-to-r from-green-500 to-blue-500 text-white p-6 rounded-b-3xl">
                        <h1 class="text-2xl font-bold text-center">Quiz Complete! üéâ</h1>
                    </div>

                    <div class="p-8 text-center">
                        <div class="bg-gray-50 p-8 rounded-3xl mb-8">
                            <div class="text-6xl mb-4">${resultEmoji}</div>
                            <div class="text-4xl font-bold text-gray-800 mb-2">${percentage}%</div>
                            <div class="text-xl text-gray-600 mb-4">${this.score.correct} out of ${this.score.total} correct</div>
                            <div class="text-lg text-gray-700">${message}</div>
                        </div>
                        <div class="space-y-3">
                            <button onclick="app.startQuiz('${this.quizType}')" class="w-full bg-gradient-to-r from-blue-500 to-purple-500 text-white p-4 rounded-2xl font-bold text-lg active:scale-95 transition-transform">Try Again</button>
                            <button onclick="app.showHome()" class="w-full bg-gray-500 text-white p-4 rounded-2xl font-bold text-lg active:scale-95 transition-transform">Back to Home</button>
                        </div>
                    </div>
                `;
            }

            showHome() {
                this.currentView = 'home';
                this.render();
            }

            showAddWord() {
                this.currentView = 'add';
                this.newWord = { japanese: '', reading: '', english: '', group: '' };
                this.editingWord = null;
                this.render();
            }

            showQuizSelect(group) {
                this.selectedGroup = group;
                this.currentView = 'quiz-select';
                this.render();
            }

            showImport() {
                this.currentView = 'import';
                this.render();
            }

            exportWords() {
                const data = {
                    words: this.words,
                    exportDate: new Date().toISOString(),
                    appVersion: 'Japanese Vocab App v1.0'
                };
                
                const jsonString = JSON.stringify(data, null, 2);
                const blob = new Blob([jsonString], { type: 'application/json' });
                const url = URL.createObjectURL(blob);
                
                const a = document.createElement('a');
                a.href = url;
                a.download = 'japanese-vocab-' + new Date().toISOString().split('T')[0] + '.json';
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                URL.revokeObjectURL(url);
            }

            importFromFile() {
                const fileInput = document.getElementById('importFile');
                const file = fileInput.files[0];
                
                if (!file) {
                    alert('Please select a file first');
                    return;
                }
                
                const reader = new FileReader();
                reader.onload = (e) => {
                    try {
                        const data = JSON.parse(e.target.result);
                        if (data.words && Array.isArray(data.words)) {
                            const importedCount = data.words.length;
                            data.words.forEach(word => {
                                if (!word.id) word.id = Date.now() + Math.random();
                            });
                            this.words = [...this.words, ...data.words];
                            this.saveData();
                            alert('Successfully imported ' + importedCount + ' words!');
                            this.showHome();
                        } else {
                            alert('Invalid file format. Please use a valid export file.');
                        }
                    } catch (error) {
                        alert('Error reading file. Please check the file format.');
                    }
                };
                reader.readAsText(file);
            }

            importFromText() {
                const text = document.getElementById('importText').value.trim();
                const group = document.getElementById('importGroup').value.trim() || 'Imported';
                
                if (!text) {
                    alert('Please enter some text to import');
                    return;
                }
                
                const lines = text.split('\n').filter(line => line.trim());
                const newWords = [];
                
                lines.forEach(line => {
                    line = line.trim();
                    if (!line) return;
                    
                    let match = line.match(/(.+?)Ôºà(.+?)Ôºâ\s*[‚Äì-]\s*(.+)/);
                    if (match) {
                        const japanese = match[1].trim();
                        const reading = match[2].trim();
                        const english = match[3].trim();
                        newWords.push({
                            id: Date.now() + Math.random(),
                            japanese: japanese,
                            reading: reading,
                            english: english,
                            group: group
                        });
                        return;
                    }
                    
                    match = line.match(/(.+?)\s*\|\s*(.+?)\s*\|\s*(.+)/);
                    if (match) {
                        const japanese = match[1].trim();
                        const reading = match[2].trim();
                        const english = match[3].trim();
                        newWords.push({
                            id: Date.now() + Math.random(),
                            japanese: japanese,
                            reading: reading,
                            english: english,
                            group: group
                        });
                        return;
                    }
                    
                    match = line.match(/(.+?)\s*[‚Äì-]\s*(.+)/);
                    if (match) {
                        const japanese = match[1].trim();
                        const english = match[2].trim();
                        newWords.push({
                            id: Date.now() + Math.random(),
                            japanese: japanese,
                            reading: japanese,
                            english: english,
                            group: group
                        });
                    }
                });
                
                if (newWords.length > 0) {
                    this.words = [...this.words, ...newWords];
                    this.saveData();
                    alert('Successfully imported ' + newWords.length + ' words!');
                    this.showHome();
                } else {
                    alert('No valid words found. Please check the format.');
                }
            }

            importGenkiLesson1() {
                const genkiWords = [
                    { japanese: 'ÁßÅ', reading: '„Çè„Åü„Åó', english: 'I' },
                    { japanese: '„ÅÇ„ÅÆ‰∫∫', reading: '„ÅÇ„ÅÆ„Å≤„Å®', english: 'that person' },
                    { japanese: 'ÂÖàÁîü', reading: '„Åõ„Çì„Åõ„ÅÑ', english: 'teacher; professor' },
                    { japanese: 'Â≠¶Áîü', reading: '„Åå„Åè„Åõ„ÅÑ', english: 'student' },
                    { japanese: 'ÁïôÂ≠¶Áîü', reading: '„Çä„ÇÖ„ÅÜ„Åå„Åè„Åõ„ÅÑ', english: 'international student' },
                    { japanese: '‰∏Ä', reading: '„ÅÑ„Å°', english: 'one' },
                    { japanese: '‰∫å', reading: '„Å´', english: 'two' },
                    { japanese: '‰∏â', reading: '„Åï„Çì', english: 'three' },
                    { japanese: 'Âõõ', reading: '„Åó/„Çà„Çì', english: 'four' },
                    { japanese: '‰∫î', reading: '„Åî', english: 'five' },
                    { japanese: 'ÂÖ≠', reading: '„Çç„Åè', english: 'six' },
                    { japanese: '‰∏É', reading: '„Åó„Å°/„Å™„Å™', english: 'seven' },
                    { japanese: 'ÂÖ´', reading: '„ÅØ„Å°', english: 'eight' },
                    { japanese: '‰πù', reading: '„Åç„ÇÖ„ÅÜ/„Åè', english: 'nine' },
                    { japanese: 'ÂçÅ', reading: '„Åò„ÇÖ„ÅÜ', english: 'ten' },
                    { japanese: '„ÅØ„ÅÑ', reading: '„ÅØ„ÅÑ', english: 'yes' },
                    { japanese: '„ÅÑ„ÅÑ„Åà', reading: '„ÅÑ„ÅÑ„Åà', english: 'no' },
                    { japanese: '„Åù„ÅÜ„Åß„Åô', reading: '„Åù„ÅÜ„Åß„Åô', english: 'that is right' },
                    { japanese: '„Åù„ÅÜ„Åß„Åô„Åã', reading: '„Åù„ÅÜ„Åß„Åô„Åã', english: 'I see; is that so' },
                    { japanese: '„Åä„ÅØ„Çà„ÅÜ', reading: '„Åä„ÅØ„Çà„ÅÜ', english: 'good morning (casual)' },
                    { japanese: '„Åä„ÅØ„Çà„ÅÜ„Åî„Åñ„ÅÑ„Åæ„Åô', reading: '„Åä„ÅØ„Çà„ÅÜ„Åî„Åñ„ÅÑ„Åæ„Åô', english: 'good morning (polite)' },
                    { japanese: '„Åì„Çì„Å´„Å°„ÅØ', reading: '„Åì„Çì„Å´„Å°„ÅØ', english: 'good afternoon' },
                    { japanese: '„Åì„Çì„Å∞„Çì„ÅØ', reading: '„Åì„Çì„Å∞„Çì„ÅØ', english: 'good evening' },
                    { japanese: '„Åï„Çà„ÅÜ„Å™„Çâ', reading: '„Åï„Çà„ÅÜ„Å™„Çâ', english: 'good-bye' },
                    { japanese: '„ÅÇ„Çä„Åå„Å®„ÅÜ', reading: '„ÅÇ„Çä„Åå„Å®„ÅÜ', english: 'thank you' },
                    { japanese: '„ÅÇ„Çä„Åå„Å®„ÅÜ„Åî„Åñ„ÅÑ„Åæ„Åô', reading: '„ÅÇ„Çä„Åå„Å®„ÅÜ„Åî„Åñ„ÅÑ„Åæ„Åô', english: 'thank you (polite)' },
                    { japanese: '„Åô„Åø„Åæ„Åõ„Çì', reading: '„Åô„Åø„Åæ„Åõ„Çì', english: 'excuse me; I am sorry' },
                    { japanese: 'Â≠¶Ê†°', reading: '„Åå„Å£„Åì„ÅÜ', english: 'school' },
                    { japanese: 'Â§ßÂ≠¶', reading: '„Å†„ÅÑ„Åå„Åè', english: 'college; university' },
                    { japanese: 'Â∞ÇÊîª', reading: '„Åõ„Çì„Åì„ÅÜ', english: 'major' },
                    { japanese: 'ÁµåÊ∏à', reading: '„Åë„ÅÑ„Åñ„ÅÑ', english: 'economics' },
                    { japanese: 'ÂõΩÈöõÈñ¢‰øÇ', reading: '„Åì„Åè„Åï„ÅÑ„Åã„Çì„Åë„ÅÑ', english: 'international relations' },
                    { japanese: '„Ç≥„É≥„Éî„É•„Éº„Çø„Éº', reading: '„Ç≥„É≥„Éî„É•„Éº„Çø„Éº', english: 'computer' },
                    { japanese: '„Éì„Ç∏„Éç„Çπ', reading: '„Éì„Ç∏„Éç„Çπ', english: 'business' },
                    { japanese: 'Ê≠¥Âè≤', reading: '„Çå„Åç„Åó', english: 'history' },
                    { japanese: '‰ªä', reading: '„ÅÑ„Åæ', english: 'now' },
                    { japanese: 'ÂçàÂâç', reading: '„Åî„Åú„Çì', english: 'A.M.' },
                    { japanese: 'ÂçàÂæå', reading: '„Åî„Åî', english: 'P.M.' },
                    { japanese: '„Ç¢„É°„É™„Ç´', reading: '„Ç¢„É°„É™„Ç´', english: 'U.S.A.' },
                    { japanese: '„Ç§„ÇÆ„É™„Çπ', reading: '„Ç§„ÇÆ„É™„Çπ', english: 'Britain' },
                    { japanese: '„Ç™„Éº„Çπ„Éà„É©„É™„Ç¢', reading: '„Ç™„Éº„Çπ„Éà„É©„É™„Ç¢', english: 'Australia' },
                    { japanese: 'ÈüìÂõΩ', reading: '„Åã„Çì„Åì„Åè', english: 'Korea' },
                    { japanese: '‰∏≠ÂõΩ', reading: '„Å°„ÇÖ„ÅÜ„Åî„Åè', english: 'China' },
                    { japanese: 'Êó•Êú¨', reading: '„Å´„Åª„Çì/„Å´„Å£„ÅΩ„Çì', english: 'Japan' }
                ];

                const wordsWithIds = genkiWords.map(word => ({
                    ...word,
                    id: Date.now() + Math.random(),
                    group: 'Genki I - Lesson 1'
                }));

                this.words = [...this.words, ...wordsWithIds];
                this.saveData();
                alert('Successfully imported ' + genkiWords.length + ' words from Genki I Lesson 1!');
                this.showHome();
            }

            saveWord() {
                const japanese = document.getElementById('japanese').value.trim();
                const reading = document.getElementById('reading').value.trim();
                const english = document.getElementById('english').value.trim();
                const group = document.getElementById('group').value.trim();

                if (!japanese || !reading || !english || !group) {
                    alert('Please fill in all fields');
                    return;
                }

                if (this.editingWord) {
                    const index = this.words.findIndex(w => w.id === this.editingWord.id);
                    this.words[index] = { ...this.editingWord, japanese, reading, english, group };
                } else {
                    this.words.push({ id: Date.now(), japanese, reading, english, group });
                }

                this.saveData();
                this.showHome();
            }

            editWord(id) {
                this.editingWord = this.words.find(w => w.id === id);
                this.newWord = { ...this.editingWord };
                this.currentView = 'add';
                this.render();
            }

            deleteWord(id) {
                if (confirm('Are you sure you want to delete this word?')) {
                    this.words = this.words.filter(w => w.id !== id);
                    this.saveData();
                    this.render();
                }
            }

            addNewGroup() {
                const newGroup = document.getElementById('newGroup').value.trim();
                if (newGroup) {
                    document.getElementById('group').value = newGroup;
                    document.getElementById('newGroup').value = '';
                }
            }

            startQuiz(type) {
                this.quizType = type;
                this.currentWordIndex = 0;
                this.showAnswer = false;
                this.showResult = false;
                this.score = { correct: 0, total: 0 };
                this.userAnswer = '';

                if (this.selectedGroup === 'random') {
                    this.studyWords = [...this.words].sort(() => Math.random() - 0.5).slice(0, Math.min(10, this.words.length));
                } else {
                    this.studyWords = this.words.filter(w => w.group === this.selectedGroup).sort(() => Math.random() - 0.5);
                }

                if (this.studyWords.length === 0) {
                    alert('No words found in this group!');
                    return;
                }

                if (type === 'multiple-choice') {
                    this.generateChoices();
                }

                this.currentView = 'quiz';
                this.render();
            }

            generateChoices() {
                const currentWord = this.studyWords[this.currentWordIndex];
                const otherWords = this.words.filter(w => w.id !== currentWord.id);
                const shuffled = otherWords.sort(() => Math.random() - 0.5);
                const choices = shuffled.slice(0, 3);
                choices.push(currentWord);
                this.currentChoices = choices.sort(() => Math.random() - 0.5);
            }

            showAnswerFlashcard() {
                this.showAnswer = true;
                this.render();
            }

            markCorrect() {
                this.score.correct++;
                this.score.total++;
                this.nextQuestion();
            }

            markIncorrect() {
                this.score.total++;
                this.nextQuestion();
            }

            checkAnswer(selectedAnswer) {
                const currentWord = this.studyWords[this.currentWordIndex];
                this.isCorrect = selectedAnswer === currentWord.english;
                this.showResult = true;
                this.score.total++;
                if (this.isCorrect) this.score.correct++;
                this.render();
            }

            checkWrittenAnswer() {
                this.userAnswer = document.getElementById('userAnswer').value.trim();
                if (!this.userAnswer) return;
                
                const currentWord = this.studyWords[this.currentWordIndex];
                this.isCorrect = this.userAnswer.toLowerCase() === currentWord.english.toLowerCase();
                this.showResult = true;
                this.score.total++;
                if (this.isCorrect) this.score.correct++;
                this.render();
            }

            nextQuestion() {
                if (this.currentWordIndex < this.studyWords.length - 1) {
                    this.currentWordIndex++;
                    this.showAnswer = false;
                    this.showResult = false;
                    this.userAnswer = '';
                    
                    if (this.quizType === 'multiple-choice') {
                        this.generateChoices();
                    }
                    
                    this.render();
                } else {
                    this.currentView = 'quiz-complete';
                    this.render();
                }
            }
        }

        const app = new JapaneseVocabApp();
    </script>
</body>
</html>
